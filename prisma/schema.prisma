// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Tabel Admin
// Menyimpan data admin yang bertanggung jawab terhadap pengelolaan system
model Admin {
  id_admin    String   @id @db.VarChar(5)
  nama_admin  String   @db.VarChar(30)
  username    String   @unique @db.VarChar(20)
  password    String   @db.VarChar(255) // Extended for bcrypt hashed password
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("admin")
}

// Tabel Pengguna
// Menyimpan data pengguna (pemilik hewan) yang menggunakan layanan penitipan
model Pengguna {
  id_pengguna   String   @id @db.VarChar(6)
  nama_pengguna String   @db.VarChar(40)
  no_hp         String   @db.VarChar(15)
  alamat        String   @db.VarChar(80)
  email         String   @unique @db.VarChar(40)
  password      String   @db.VarChar(255) // For authentication
  foto          String?  @db.VarChar(255) // Profile picture URL from Google/Facebook
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relasi one-to-many dengan Hewan
  hewan         Hewan[]

  @@map("pengguna")
}

// Tabel Hewan
// Menyimpan data hewan peliharaan milik pengguna
model Hewan {
  id_hewan         String  @id @db.VarChar(6)
  id_pengguna      String  @db.VarChar(6)
  nama_hewan       String  @db.VarChar(30)
  jenis            String  @db.VarChar(20)
  usia             Int
  kebutuhan_khusus String? @db.VarChar(50)
  
  // Relasi many-to-one dengan Pengguna
  pengguna         Pengguna    @relation(fields: [id_pengguna], references: [id_pengguna], onDelete: Cascade)
  
  // Relasi one-to-many dengan Pemesanan
  pemesanan        Pemesanan[]

  @@map("hewan")
}

// Tabel Layanan
// Menyimpan daftar layanan penitipan dan perawatan yang tersedia
model Layanan {
  id_layanan   String @id @db.VarChar(5)
  nama_layanan String @db.VarChar(30)
  harga        Int
  deskripsi    String @db.VarChar(150)
  
  // Relasi one-to-many dengan Pemesanan
  pemesanan    Pemesanan[]

  @@map("layanan")
}

// Tabel Pemesanan
// Menyimpan data transaksi penitipan hewan yang dilakukan oleh pengguna
model Pemesanan {
  id_pemesanan String   @id @db.VarChar(8)
  id_hewan     String   @db.VarChar(6)
  id_layanan   String   @db.VarChar(5)
  tgl_masuk    DateTime @db.Date
  tgl_keluar   DateTime @db.Date
  status       String   @db.VarChar(20)
  catatan      String?  @db.VarChar(255)
  
  // Relasi many-to-one dengan Hewan
  hewan        Hewan      @relation(fields: [id_hewan], references: [id_hewan], onDelete: Cascade)
  
  // Relasi many-to-one dengan Layanan
  layanan      Layanan    @relation(fields: [id_layanan], references: [id_layanan], onDelete: Cascade)
  
  // Relasi one-to-many dengan Pembayaran
  pembayaran   Pembayaran[]

  @@map("pemesanan")
}

// Tabel Pembayaran
// Menyimpan data transaksi pembayaran untuk penitipan hewan
model Pembayaran {
  id_pembayaran String   @id @db.VarChar(8)
  id_pemesanan  String   @db.VarChar(8)
  tanggal_bayar DateTime @db.Date
  jumlah_bayar  Int
  metode        String   @db.VarChar(50)
  bukti_bayar   String?  @db.VarChar(255)
  
  // Relasi many-to-one dengan Pemesanan
  pemesanan     Pemesanan @relation(fields: [id_pemesanan], references: [id_pemesanan], onDelete: Cascade)

  @@map("pembayaran")
}

// NextAuth.js Models
// Required for NextAuth session management

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}
